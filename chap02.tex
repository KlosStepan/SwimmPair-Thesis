\chapter{Architecture overview}
Overview should familiarize the reader with architecture of the application. There are two parts, \textbf{public web} and \textbf{private administration}. Administration is hidden behing password and for storing login there is session. 
\par
When designing such system, object oriented approach and grouping of similar functions together is a good thing. There are objects that have to move around the CMS described in previous chapter. These objects are Post, User, Club, Cup, Position and Region. Therefore we came up with a concept of controllers. Each page of SwimmPair is composed of same headerer, menu, footer. The content part is filled with page's specific results of controller call put into UI. These controllers must be distributed for use to all pages.
\section{Controllers}
Controllers are written to provide API functionality for system administration in PHP. These controllers are populating pages or taking new input from them and administer process of storing them.
\begin{itemize}
    \item PostsManager
    \item UsersManager
    \item ClubsManager
    \item CupsManager
    \item PositionsManager
    \item RegionsManager
\end{itemize}
Controlers are implemented to extract and store data of class by which they are named after. Let's take PostsManager as an example. The Manager is implemented as following.  
Post
\begin{lstlisting}
<?php

class Post
{
    public $id;
    public $timestamp;
    public $title;
    public $content;
    public $display_flag;
    public $author_user_id;
	public $signature_flag;

    public function __construct($id, $timestamp, $title, $content, $display_flag, $author_user_id, $signature_flag)
    {
        $this->id = $id;
        $this->timestamp = $timestamp;
        $this->title = $title;
        $this->content = $content;
        $this->display_flag = $display_flag;
        $this->author_user_id = $author_user_id;
        $this->signature_flag = $signature_flag;
    }

	//7/7: {id, timestamp, title, content, display_flag, author_user_id, signature_flag}
	public function Serialize()
	{
		$_serialized = "{\"id\":\"".$this->id."\",\"timestamp\":\"".$this->timestamp."\",\"title\":\"".$this->title."\",\"content\":\"".$this->content."\",\"display_flag\":\"".$this->display_flag."\",\"author_user_id\":\"".$this->author_user_id."\",\"signature_flag\":\"".$this->signature_flag."\"}";
		return $_serialized;
	}

}

\end{lstlisting}
PostsManager  
\begin{lstlisting}
<?php

class PostsManager
{
	private $mysqli;
	public function __construct(mysqli $mysqli)
	{
		$this->mysqli = $mysqli;
	}
	public function GetPostByID($id)
	{
		$statement = $this->mysqli->prepare("CALL `GetPostByID`(?);");
		$statement->bind_param('i', $id);
		return $this->_CreatePostOrNullFromStatement($statement);
	}
	public function FindLastNPosts($N)
	{
		$statement = $this->mysqli->prepare('CALL `FindLastNPosts`(?);');
		$statement->bind_param('i', $N);
		$posts = $this->_CreatePostsFromStatement($statement);
		return $posts;
	}
	public function InsertNewPost($title, $content, $display_flag, $author, $signature_flag)
	{
		$statement = $this->mysqli->prepare('CALL `InsertNewPost`(?, ?, ?, ?, ?);');
		$statement->bind_param('ssiii', $title, $content, $display_flag, $author, $signature_flag);
		if ($statement->execute())
        {
			return true;
		}
   		else
        {
			return false;
		}
	}
    public function UpdatePost($id, $title, $content, $display_flag, $signature_flag)
    {
        $this->mysqli->begin_transaction();
        try
        {
            $statement = $this->mysqli->prepare("CALL `UpdatePost`(?, ?, ?, ?, ?);");
            $statement->bind_param('ssiii', $title, $content, $id, $display_flag, $signature_flag);
            $statement->execute();
            $this->mysqli->commit();
            return true;
        }
        catch(RuntimeException $e)
        {
            $this->mysqli->rollback();
            return false;
        }
    }
    //Private functions
	private function _CreatePostOrNullFromStatement(mysqli_stmt $statement)
	{
		$statement->execute();
		$row = $statement->get_result()->fetch_assoc();
		if ($row !== NULL)
        {
			return $this->_CreatePostFromRow($row);
		}
 		else
        {
			return NULL;
		}
	}
	private function _CreatePostsFromStatement(mysqli_stmt $statement)
	{
		$statement->execute();
		$rows = $statement->get_result()->fetch_all(MYSQLI_ASSOC);
		$posts = [];
		foreach ($rows as $row)
		{
			$posts[] = $this->_CreatePostFromRow($row);
		}
		return $posts;
	}
	private function _CreatePostFromRow(array $row)
	{
		return new Post($row['id'], $row['timestamp'], $row['title'], $row['content'], $row['display_flag'], $row['author_user_id'], $row['signature_flag']);
	}
}

\end{lstlisting}
\section{Start file}
Start file serves for connecting to database, definition of error handling, sanitization of input and most importantly includes defition of objects and controllers and constructs all controller passing reference to mysqli connection as their ctor argument
\begin{lstlisting}
$postsManager     = new PostsManager($mysqli);
$usersManager     = new UsersManager($mysqli);
$clubsManager     = new ClubsManager($mysqli);
$cupsManager      = new CupsManager($mysqli);
$positionsManager = new PositionsManager($mysqli)
\end{lstlisting}
\section{Templating of web and administration}
Each page of public web in / gets assembled from these three prefabricated parts
\begin{itemize}
    \item HEADER
    \item MENU
    \item page specialization - usually generated from result obtained by a controller call and might be updated by XMLHttpRequest call \& DOM modification
    \item FOOTER
\end{itemize}
Homepage of /admin/profile.php gets assembled with regards to rights the logged user has. The ordering is following: Admin(2)\textgreater Club manager(1)\textgreater Swimming referee(0)
\begin{itemize}
    \item ADMIN SUBMENU - 2, 1, 0
    \item CLUB MANAGER SUBMENU - 1, 0
    \item SWIMMING REFEREE SUBMENU - 0
\end{itemize}
\section{Responsive layout}
These media queries are used to provide design of the web. CSS design supports mobile devices and printing of cup pairing.
\begin{itemize}
    \item Basic CSS design
    \item @media (max-width: 768px) \{ ... \}
    \item @media (print) \{ ... \}
\end{itemize}
\section{Administrative tasks description}
These are the tasks we need to perform.
\begin{itemize}
    \item Add post
    \item Edit post
    \item Add user
    \item Edit user
    \item Assign users
    \item Add cup
    \item Edit cup
\end{itemize}    
Adminn:
All tasks and Drag n drop hlavne.
Add post, Edit post
Add club, Edit club
Crea
Manager:
Rozhodci
\section{Mobile app for administration}
\par
Mobile app was created in Xamarin. Xamarin allows cross-platform mobile development in Csharp.NET and XAML targeting of .NET Standard 2.0. While deploying, Mono runtime is used on both platforms to run the app. Despite some differencies, especially worse runtime support and necessity of AOT compilation at iOS this tool is able to save a lot of time. 
\section{SESSION and TOKEN provisioning}